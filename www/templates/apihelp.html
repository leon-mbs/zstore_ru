<html>
    <head>
        <title>API help</title>
        <link rel="stylesheet" href="/assets/css/adminlte.css">


    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-xl-10  pl-4 pr-4">
                    <h2>Описание API</h2>
                    <p>API предназначено для экспорта заказов и ТТН(товарно-транспортных накладных) в складскую систему и
                         отслеживание их статусов.

                    </p>
                    <h3>Формат обмена</h3>
                    <p>В качестве протокола в API используется <a target="_blank" href="https://www.jsonrpc.org/specification">JSON-RPC</a>.
                        <br>Сообщения отправляются методом POST и в лющем  имеет  вид:
                        <br><code>{"jsonrpc": "2.0", "method": "echo", "params": {"say": "Привет"}, "id": 1}</code>
                    <ul>
                        <li>jsonrpc - всегда "2.0"</li>
                        <li>method - функция что вызывается</li>
                        <li>params - параметры (необязательное поле)</li>
                        <li>id - идентификатор запроса</li>
                    </ul>
                    Идентификатор запроса возвращается в ответ и может быть бедья каким но уникальным в случае пакетного
                     (batch)
                     запроса, поскольку сервер может быть асинхронным и вернуть ответы в произвольном порядке. В случае
                     отсутствия идентификатора считается что - запрос это нотификация и не требует ответа.
                    <br> Пакетный запрос
                    <br><code>[{"jsonrpc": "2.0", "method": "echo", "params": {"say": "Привет"}, "id": 1}, {"jsonrpc": "2.0",
                        "method": "echo", "params": {"say": "Пока"}, "id": 1} ]</code>
                    <br> Ответ имеет  вид
                    <br>
                    <code> {"jsonrpc": "2.0", "result": {"answer": "Привіт"}, "id": 1} </code>
                    <ul>
                        <li>jsonrpc - всегда "2.0"</li>
                        <li>result - ответ</li>
                        <li>error - возвращается вместо result если  ошибка</li>
                        <li>id - соответствующий идентификатор из запроса</li>
                    </ul>
                    </p>
                    <h3>Авторизацмя</h3>
                    <p>
                        Тип авторизации задается в настройках и может быть на основании JWT токена, Basic аутентификации
                         или авторизация может не использоваться (например, в локальной сети).
                         Bearer и Basic аутентификация отправляются стардартным образом в заголовке Authorization.
                         Для Bearer предварительно необходимо получить JWT токен.
                    </p>
                    <h4>Перечень  функций</h4>
                    Для логического группирования запросов используются отдельные точки входа  (endpoints)
                    <table class="table  table-sm table-bordered">
                        <tr>
                            <th class="text-nowrap text-center  ">Название</th>
                            <th class="text-nowrap text-center">URL (endpoint)</th>
                            <th class="text-nowrap text-center">Команда</th>
                            <th class="text-nowrap text-center">Параметры</th>
                            <th class="text-nowrap text-center"> Пример</th>
                            <th class="text-nowrap text-center"> Примечание</th>
                        </tr>

                        <tr>
                            <td class="  text-bold">Получить токен</td>
                            <td>/api/common</td>
                            <td>token</td>
                            <td class="text-nowrap">login - логин
                                <br>password - пароль
                            </td>
                            <td>{"login":"admin","password":"admin"}</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Список складов</td>
                            <td>/api/items</td>
                            <td>storelist</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Список категорий</td>
                            <td>/api/items</td>
                            <td>catlist</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Список артикулов</td>
                            <td>/api/items</td>
                            <td>articlelist</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Список ТМЦ</td>
                            <td>/api/items</td>
                            <td>itemlist</td>
                            <td class="text-nowrap">cat_id - id категорії</td>
                            <td>{"cat_id":"10"}</td>
                            <td>Если категория не  задана возвращается весь список. Поле descriptiion
                                возвращается в  кодировке base64
                            </td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Наличие на складах</td>
                            <td>/api/items</td>
                            <td>getqty</td>
                            <td class="text-nowrap">store_id - id склада</td>
                            <td>{"store_id":"1"}</td>
                            <td>Если склад не задан возвращается весь список.</td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Записать ТМЦ</td>
                            <td>/api/items</td>
                            <td>save</td>
                            <td class="text-nowrap">itemname - наименование, обязательное поле
                                <br>item_code - артикул, обязательное поле
                                <br>bar_code - штрих-код
                                <br>measure - ед. измерения
                                <br>manufacturer - производитель, бренд
                                <br>cat_id - id категории
                                <br>price1,... - отпускные цены
                                <br> desсription - описание, в base64
                            </td>
                            <td>{
                                "item_code":"К001","bar_code":"К001","itemname":"testapi","description":"","measure":"шт","manufacturer":"",
                                "cat_id":"0","price1":50}
                            </td>
                            <td>Если артикул (item_code) существует то ТМЦ перезаписсывается, иначе создается                                  .
                            </td>
                        </tr>


                        <tr>
                            <td class="  text-bold">Список контрагентов</td>
                            <td>/api/customers</td>
                            <td>list</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Записать контрагента</td>
                            <td>/api/customers</td>
                            <td>save</td>
                            <td class="text-nowrap">customer_id - id контрагента
                                <br> customer_name - наименование, обязательное поле
                                <br> phone - телефон, рекомендуется  вводить как 10 цифр
                                <br> email - email
                                <br> city - город
                                <br> address - адрес
                                <br> desсription - описание, в base64
                            </td>

                            <td> {"customer_id":"8","customer_name":"\"ООО
                                Вектор2\"","phone":"0991111111","email":"test@ukr.net","city":"","address":""}
                            </td>
                            <td>Если customer_id больше нуля, то контрагент перезаписывается, если равен нулю или отсутствует то
                                 создается новый.
                            </td>

                        </tr>
                        <tr>
                            <td class="text-nowrap text-bold">Список статусов документов</td>
                            <td>/api/docs</td>
                            <td>statuslist</td>
                            <td></td>
                            <td></td>
                            <td>Не все статусы подхожят ко  всем типам документов</td>
                        </tr>
                        <tr>
                            <td class="text-nowrap text-bold">Список филиалов</td>
                            <td>/api/docs</td>
                            <td>branchlist</td>
                            <td></td>
                            <td></td>
                            <td>Если учетной системе включена поддержка филиалов необходимо указывать филиал в создаваемом
                                 документы
                            </td>
                        </tr>

                        <tr>
                            <td class="  text-bold">Создание заказа, если заказы обрабатываются на стороне складской системы
                            </td>
                            <td>/api/docs</td>
                            <td>createorder</td>
                            <td class="text-nowrap">number - номер документа. Уникальное значение связано с заказом в основной системе 
                                <br> phone - телефон, если телефон контакта отличается от телефона контрагента
                                <br> email - email, на случай если email контакта отличается от email контрагента
                                <br> ship_address - адреса доставки, та інші дані доставки
                                <br> description - коментарий в base64
                                <br> customer_id - контрагент
                                <br> amount - всего по документу насчет оплаты. В случае если отличается от всего по позициям (например по скидкам)
                                <br> items - список позиций
                                <br> branch_id - филиал  если  включен
                                <br> item_code - артикул
                                <br> quantity - количество
                                <br> price - ціна
                            </td>
                            <td>
                                {"number":"ID0001","phone":"0971111111","ship_address":"Харьков","items":[{"item_code":"cbs500-1","quantity":2,"price":234},{"item_code":"ID0018","quantity":2,"price":234}]
                                }
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Створення ТТН якщо потрібно тільки списання зі складу</td>
                            <td>/api/docs</td>
                            <td>createttn</td>
                            <td class="text-nowrap">number - номер документу. Унікальне значення пов'язане з замовленням в
                                основній системі
                                <br> phone - телефон, на випадок якщо телефон контакту відрізняєтся від телефона контрагента
                                <br> email - email, на випадок якщо email контакту відрізняєтся від email контрагента
                                <br> ship_address - адреса доставки, та інші дані доставки
                                <br> customer_id - контрагент
                                <br> description - коментар в base64
                                <br> amount - всього по документу що до оплати. На випадок якщо відрізняется від всього по
                                позаціях (наприклад зза знижки)
                                <br> branch_id - фiлiя якщо ввiмкнено
                                <br> items - список позицій
                                <br> item_code - артикул
                                <br> quantity - количество
                                <br> price - ціна
                            </td>
                            <td>
                                {"number":"ID0001","phone":"0971111111","ship_address":"Харьков","items":[{"item_code":"cbs500-1","quantity":2,"price":234},{"item_code":"ID0018","quantity":2,"price":234}]
                                }
                            </td>
                            <td></td>
                        </tr>
                         <tr>
                            <td class="  text-bold">Створення   видаткової накладної</td>
                            <td>/api/docs</td>
                            <td>goodsissue</td>
                            <td class="text-nowrap">number - номер документа. Унікальне значення 
                                основній системі. Обов`язковее поле
                                <br> mf - каса  или  банкiвский  рахунок
                                <br> branch_id - фiлiя якщо ввiмкнено
                                <br> customer_id - контрагент
                                <br> store_id - склад, обов`язкове поле
                                <br> autoexec - true, якщо треба  записати  проводки
                                <br> total - всього по документу що до оплати. На випадок якщо відрізняется від всього по
                                позаціях (наприклад з-за знижки)
                                <br> payed - внесена сума  оплати.
                                <br> items - список позицій
                                <br> item_code - артикул
                                <br> quantity - количество
                                <br> price - цена
                            </td>
                            <td>
                                {"number":"ID0001","store_id":19,"customer_id":8,"mf":2,"total":220,"payed":220,"items":[{"item_code":"cbs500-1","quantity":2,"price":234},{"item_code":"ID0018","quantity":2,"price":234}]
                                }
                            </td>
                            <td></td>
                        </tr>
              
                       
                       <tr>
                            <td class="  text-bold">Оприбуткування  ТМЦ</td>
                            <td>/api/docs</td>
                            <td>incomeitem</td>
                            <td class="text-nowrap">number - номер документа. Унікальне значення 
                                основній системі. Обов`язкове поле
                                <br> mf - каса  или  банкiвский  рахунок
                                <br> branch_id - фiлiя якщо ввiмкнено
                                <br> store_id - склад, обов`язкове поле
                                <br> autoexec - true, якщо треба  записати  проводки
                                <br> total - всього по документу що до оплати. На випадок якщо відрізняется від всього по
                                позаціях (наприклад з-за знижки)
                                <br> items - список позицій
                                <br> item_code - артикул
                                <br> quantity - количество
                                <br> price - цена
                            </td>
                            <td>
                                {"number":"ID0001","autoexec":true,"store_id":19,"customer_id":8,"mf":2,"total":220,"payed":220,"items":[{"item_code":"cbs500-1","quantity":2,"price":234},{"item_code":"ID0018","quantity":2,"price":234}]
                                }
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="  text-bold">Статуси документів по списку номерів</td>
                            <td>/api/docs</td>
                            <td>checkstatus</td>
                            <td class="text-nowrap">numbers - список номерів документів</td>
                            <td>{"numbers":["З-00002","ТТН00034"] }</td>
                            <td>Повертаются тільки ті документи які створені через API. По поверненим статусам оновляются
                                статуси замовлень в основній системі
                            </td>
                        </tr>
                        <tr>
                            <td class="text-nowrap text-bold">Запит на видалення.</td>
                            <td>/api/docs</td>
                            <td>cancel</td>
                            <td class="text-nowrap">number - номер документу<br>reason - причина</td>
                            <td>{"number": "ТТН00034","reason":"Тест" }</td>
                            <td> Запит адміністратору складу на видалення документу. Наприклад якщо замовлення відмінено але
                                вже експортовано.
                            </td>
                        </tr>
 <tr>
                            <td class="  text-bold">Перелiк робiт та  послуг</td>
                            <td>/api/items</td>
                            <td>servicelist</td>
                            <td class="text-nowrap"></td>
                            <td></td>
                            <td>
                            </td>
                        </tr>  
                        
 <tr>
                            <td class="  text-bold">Створення акту  виконаних рабiт</td>
                            <td>/api/docs</td>
                            <td>serviceact</td>
                            <td class="text-nowrap">number - номер документа. Унікальне значення 
                                основній системі. Обов`язковее поле
                                <br> mf - каса  или  банкiвский  рахунок
                                <br> branch_id - фiлiя якщо ввiмкнено
                                <br> customer_id - контрагент
                                <br> device - вирiб замовника
                              
                                <br> autoexec - true, если  отправляется  на  виполнение
                                <br> total - всього по документу що до оплати. На випадок якщо відрізняется від всього по
                                позаціях (наприклад з-за знижки)
                                <br> payed - внесена сума  оплати.
                                <br> items - список позицій
                                <br> service_id - id 
                                <br> quantity - количество
                                <br> price - цена
                            </td>
                            <td>
                                {"number":"ID0001", "customer_id":8,"mf":2,"total":220,"payed":220,"items":[{"service_id":"5","quantity":2,"price":234} ]
                                }
                            </td>
                            <td></td>
                        </tr>                        
                        
                                              
                    </table>
                    <h4>Коды ошибок</h4>
                    <table class="table table-sm" style="width:400px;">
                        <tr>
                            <td>-1000</td>
                            <td>Неверный логин</td>
                        </tr>
                        <tr>
                            <td>-1001</td>
                            <td>Пользователь не найден</td>
                        </tr>
                        <tr>
                            <td>-1002</td>
                            <td>Просроченый токен</td>
                        </tr>
                        <tr>
                            <td>-1003</td>
                            <td>Неверный синтаксис</td>
                        </tr>
                        <tr>
                            <td>-1004</td>
                            <td>Неверный запрос</td>
                        </tr>
                        <tr>
                            <td>-1005</td>
                            <td>Неверная команда</td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
        <br> <br>
    </body>
</html>
