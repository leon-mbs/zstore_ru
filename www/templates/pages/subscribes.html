<html>
 <head>
        <title>  Подписки на  события  </title>

    </head>

    <body>
        <div class="row">
            <div class="col-12 col-md-10 col-xl-8">
                <div zippy="plist">
                    <h3>Подписки на  события </h3>
                    <small>Для отправки  email и подписок по расписанию следует включить <a href="/index.php?p=App/Pages/CronTab">планировщик</a></small>
                    <br>
                    <a  zippy="addnew" class="btn btn-info">Добавить</a>
                    <table class="table  table-sm">
                        <tr>
                            <th>Тип события</th>
                            <th>Получатель</th>
                            <th>Тип уведомления</th>
                     
                            <th> </th>
                            <th> </th>

                        </tr>
                        <tr zippy="subslist">
                            <td zippy="sub_typename"> </td>
                            <td zippy="reciever_typename"> </td>
                            <td zippy="msg_typename"> </td>
                            <td zippy="desc"> </td>
                            <td> <a zippy="edit"><i class="fa fa-edit"></i> </a> </td>

                        </tr>

                    </table>
                </div>
            </div>
        </div>


        <form zippy="editform">      <h4>Редактировать</h4>
            <div class="row">

                <div class="col-12 col-md-4 col-xl-3">

                    <div class="form-group">
                        <label for="editeventtype">Тип события</label>
                        <select   class="form-control" zippy="editeventtype">
                          <option value="0">Не выбран</option> 

                        </select>
                    </div>
                    <div class="form-group">
                        <label data-label="editdoctype" for="editdoctype">Тип документа</label>
                        <select   class="form-control" zippy="editdoctype">
                            <option value="0">Не выбран</option> 
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-label="editstate" for="editstate">Статус</label>
                        <select   class="form-control" zippy="editstate">
                            <option value="0">Не выбран</option> 

                        </select>
                    </div>

                      
                    
                    <div class="form-group">
                        <label for="editrecievertype">Получатель</label>
                        <select   class="form-control" zippy="editrecievertype">
                          <option value="0">Не выбран</option> 
                        </select>
                    </div>           
 
                    <div class="form-group">
                        <label data-label="edituser" for="edituser">Пользователь</label>
                        <select   class="form-control" zippy="edituser">
                            <option value="0">Не выбран</option>        
                        </select>
                    </div>           
                     <div class="form-check">
                        <input zippy="editdisabled" type="checkbox" class="form-check-input">
                        <label class="form-check-label" for="editdisabled">Не активно</label>
                    </div>               

                </div>  
                <div class="col-12 col-md-6 col-xl-4">


                    <div class="form-group">
                        <label for="editmsgtype">Тип уведомления</label>
                        <select   class="form-control" zippy="editmsgtype">
                           <option value="0">Не выбран</option> 

                        </select>
                    </div>  
                    
                     <div class="form-group">
                        <label data-label="editemail" for="editemail">Email</label>
                        <input  type="email"  class="form-control" zippy="editemail">
                    </div>                    
                    
                    <div class="form-group">
                        <label data-label="editmsgsubject" for="editmsgsubject">Тема сообщения</label>
                        <input    class="form-control" zippy="editmsgsubject">
                    </div>
                    
                    <div class="form-group">
                        <label data-label="editurl" for="editurl">URL</label>
                        <input type="url"   class="form-control" zippy="editurl">
                         <small data-label="editurl">Запрос отправояется  методом POST</small>

                    </div>
                    <div class="form-group">
                        <label data-label="editchatid" for="editchatid">Chat ID</label>
                        <input    class="form-control" zippy="editchatid">


                    </div>
                    
              
                    <div class="form-group">
                        <label for="editmsgtext">Текст сообщения</label>
                        <textarea style="height:150px"   class="form-control" zippy="editmsgtext">
                    
                        </textarea>
                        <a href="javascript:void(0);" data-toggle="modal"
                           data-target="#modaltag">Описание тэгов <small><i class="fa fa-info-circle"></i></small></a>
                    </div>      


                    <div class="form-check">
                        <input data-label="editattach" zippy="editattach" type="checkbox" class="form-check-input">
                        <label class="form-check-label" for="editattach">Присоединить pdf</label>
                    </div>               
                    <div class="form-check">
                        <input data-label="edithtml" zippy="edithtml" type="checkbox" class="form-check-input">
                        <label class="form-check-label" for="edithtml">HTML формат</label>
                    </div>               
                </div> 
                <div class="col-12  ">    
                    <div class="form-group">
                        <a zippy="cancel"     class="btn btn-outline-info mr-4 ">Отменить</a>
                        <input zippy="save" type="submit" value="Сохранить" class="btn btn-primary mr-4  ">
                        <a zippy="delete"     class="btn btn-danger mr-4  "> Удалить</a>

                    </div>
                </div>   
            </div>         
        </form>

        <div id="modaltag" class="modal fade  " tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
             aria-hidden="true">
            <div class="modal-dialog  ">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Описание тегов шаблонизатора</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Теги используются для подстановки данных из контекста (например, документа). 
                      Для системных сообщений и e-mail в разметке можно использовать HTML.
                        <a href="https://core.telegram.org/bots/api#html-style">Доступные HTML тэги</a> для отправки через Телеграм.
                        <br>
                        <br>Для  реадизации логики используется синтаксис шаблонизатора  Mustache
                        <br>
                        Тэги шаблонизатора для документа :
                        <table  >
                            <tr><td><small><b>{customer_name}</b></small> </td><td><small>Наименоание  контрагшента</small></td></tr>
                            <tr><td><small><b>{customer_name}</b></small> </td><td><small>Телефон контрагента</small></td></tr>
                            <tr><td><small><b>{document_id}</b></small></td><td><small>ID документа</small></td></tr>
                            <tr><td><small><b>{document_number}</b></small></td><td><small>Номер документа</small></td></tr>
                            <tr><td><small><b>{doc_dn}</b></small></td><td><small>Номер документа (только цифри)</small></td></tr>
                            <tr><td><small><b>{document_date}</b></small> </td><td><small>Дата документа</small></td></tr>
                            <tr><td><small><b>{document_type}</b></small> </td><td><small>Тип документа</small></td></tr>
                            <tr><td><small><b>{amount}</b></small> </td><td><small>Сумма по документу</small></td></tr>
                            <tr><td><small><b>{mf} </b></small></td><td><small>Касса, банк</small></td></tr>
                            <tr><td><small><b>{mfacc} </b></small></td><td><small>Расчетный счет (если банк)</small></td></tr>
                            <tr><td><small><b>{nal} </b></small></td><td><small>Нал/безнал</small></td></tr>
                            <tr><td><small><b>{pos} </b></small></td><td><small>POS терминал</small></td></tr>
                            <tr><td><small><b>{forpay} </b></small></td><td><small>К оплате</small></td></tr>
                            <tr><td><small><b>{source} </b></small></td><td><small>Источник продаж</small></td></tr>
                            <tr><td><small><b>{device} </b></small></td><td><small>Издеоие, принятое  от заказчика</small></td></tr>
                            <tr><td><small><b>{credit} </b></small></td><td><small>Долг  покупателя</small></td></tr>
                            <tr><td><small><b>{payed} </b></small></td><td><small>Принята оплата по документу</small></td></tr>

                            <tr><td><small><b>{orderno} </b></small></td><td><small>Номер заказа. Еслидокумент не  Заказ будет  поиск  родительского документа Заказ</small></td></tr>
                            <tr><td><small><b>{author} </b></small></td><td><small>Автор документа</small></td></tr>
                            <tr><td><small><b>{notes} </b></small></td><td><small>Примечание к  документу   </small></td></tr>
                            <tr><td><small><b>{docurl} </b></small></td><td><small>Внещняя ссылка (URL) на документ</small></td></tr>
                            <tr><td><small><b>{botname} </b></small></td><td><small>Телеграм-бот </small></td></tr>
                          
                        </table>
                        Тэги для контрагента :
                        <table  >
                            <tr><td><small><b>{customer_name}</b></small> </td><td><small>Имя контрагента</small></td></tr>
                            <tr><td><small><b>{customer_id}</b></small></td><td><small>ID контрагента</small></td></tr>
                        
                        </table>
                        
                        Тэги для итогов дня :
                        <table  >
                            <tr><td><small><b>{day_nal}</b></small> </td><td><small>Наличная выручка за день</small></td></tr>
                            <tr><td><small><b>{day_beznal}</b></small></td><td><small>Безналичная выручка за день</small></td></tr>
                            <tr><td><small><b>{day_summa}</b></small></td><td><small>Сумма продаж по товарам</small></td></tr>
                            <tr><td><small><b>{day_return}</b></small></td><td><small>Сумма возвратов  по товарам</small></td></tr>
                             
                        </table>
                         <br>
                        
                               Если шужно вывести  текст  в  зависимости от надичия значения, например
                        <br>
                             {#credit}
                                Ваш долг {credit}  &nbsp;
                             {/credit}
                        <br>
                        <br>
                        Для списков, например  позиций документа, нужно вставит информаци. между  тэгами, например
                        {#list}  и {/list&gt;}  
                        <br>  В повторяемой  строке  допускаются  тэги

                        <table  >
                            <tr><td><small><b>{item_name}</b></small> </td><td><small>Наименование товара</small></td></tr>
                            <tr><td><small><b>{item_code}</b></small></td><td><small>Артикул</small></td></tr>
                            <tr><td><small><b>{item_barcode}</b></small> </td><td><small>Штрих код</small></td></tr>
                            <tr><td><small><b>{msr}</b></small> </td><td><small>Ед. измерения</small></td></tr>
                            <tr><td><small><b>{qty} </b></small></td><td><small>Количество</small></td></tr>
                            <tr><td><small><b>{price} </b></small></td><td><small>Цена</small></td></tr>
                            <tr><td><small><b>{summa} </b></small></td><td><small>Сумма по строке</small></td></tr>
                  
                        </table>
                        Наприклад:<br>
                        <p class="text-bold">
                            Привет {customer_name}&lt;br&gt; <br> 
                           <br>
                            &lt;table&gt;  <br>
                            &lt;tr&gt; &lt;th&gt;Товар&lt;/th&gt; &lt;th align="right" &gt;Кол. &lt;/th&gt; &lt;/tr&gt;<br>
                            {#list} <br>
                            &lt;tr&gt; &lt;td&gt;{item_name} &lt;/td&gt; &lt;td align="right" &gt;{qty} &lt;/td&gt;&lt;/tr&gt; <br>
                            {/list} <br>
                            &lt;/table&gt;&lt;br&gt;   <br> 
                            К оплате {forpay}   &lt;br&gt;<br> 
                            
                           
                        </p>


                    </div>

                </div>
            </div>
        </div>  


        <script>
            function check_delete() {
                return confirm("Удалить подписку?")
            }
        </script>
    </body>   
</html>   
 
