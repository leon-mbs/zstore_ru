<html>
    <head>
        
             <title> Справочник контрагентов</title>
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
 
    </head>

    <body>  
        <div class="row">
            <div class="col-12   col-xl-10  ">
                <div zippy="customertable">
                    <h2>Справочник контрагентов </h2>
                    <div class="card  ">
                        
                    </div>
                    <div class="card ">
                    <form zippy="leadf" class="form-inline ">
                            <input   zippy="chleads" type="checkbox"> <label for="chleads"> Режим работы с лидами </label>
                        </form>
                        <form zippy="filter" class="form-inline ">

                            <label for="searchkey">Поиск</label>
                            <input class="form-control mr-sm-2" type="search" zippy="searchkey">
                            {{^leadmode}}
                            <label for="searchtype">Тип</label>
                            <select zippy="searchtype" class="form-control mr-sm-2">
                                <option value="0">Все активные</option>
                                <option value="1">Покупатели</option>
                                <option value="2">Поставщики</option>
                                <option value="5">Холдинги</option>
                                <option value="10">Деактивированы</option>
                            </select>

                            <label for="searchholding">дочерний для</label>
                            <select zippy="searchholding" class="form-control mr-sm-2">
                                <option value="0">Не указано</option>
                            </select>
                            {{/leadmode}}
                            {{#leadmode}} 
                            <label for="searchleadsource">источник</label>
                            <select zippy="searchleadsource" class="form-control mr-2">
                                <option value="0">Не указано</option>
                            </select>    
                            <label for="searchleadstatus">состояние</label>
                            <select zippy="searchleadstatus" class="form-control mr-2">
                                <option value="0">Не указано</option>
                            </select>    
                            {{/leadmode}} 
                            <input class="btn btn-outline-success   " type="submit" value="ОК"  >
                             <a zippy="erase" title="Скинуть фильтр"><i class="fa fa-eraser"></i></a>

                        </form>
                      
                        {{#leadmode}}  

                        <a class="btn btn-outline-success mr-2"   zippy="leadsourcesedit"  ><i class="fa fa-cog"> Источник лидов</i> </a>
                         <a class="btn btn-outline-success    " zippy="leadstatusesedit"  ><i class="fa fa-cog"> Состояние лидов</i> </a>
                        {{/leadmode}}            
                    </div>
                    {{#leadmode}}  
                    <div class="mb-4 ml-2">
  
                        <a zippy="showstat"><i class="fa fa-chart-area"></i> Статистика</a>

                    </div>
                    {{/leadmode}}  
                    
                    
                     <details class="mb-2 ml-2">
                        <summary >Тэги</summary>
                        <small zippy="taglist"></small>
                     </details>
                    
                    
                    <a zippy="addnew" class="btn btn-primary">Добавить нового</a>
                           
                    <form zippy="listform">
                        <table class="table table-hover   table-sm mt-2">
                            <tr>
                                <th onclick=" $('.seldel').prop('checked', $('.seldel').prop('checked') == false);"
                                    style="width:30px;cursor:pointer" title="Снять/выставить флаг"><i
                                        class="fa fa-check-double"></i></th>

                                <th ><a zippy="sortname">Имя</a> </th>
                                <th >Тел.</th>
                                <th >E-Mail</th>
                                <th >ОКПО</th>
                                {{^leadmode}}        <th  ><a zippy="sortdoc">Док.</a> </th>    {{/leadmode}}
                                {{#leadmode}}     <th><a zippy="sortleadstatus">Состояние лида</a> </th>     {{/leadmode}} 
                                {{#leadmode}}     <th><a zippy="sortleaddate">Дата</a> </th>     {{/leadmode}} 
                                <th> </th>
                                <th> </th>
                                <th> </th>


                                <th> </th>
                                <th> </th>
                                <th> </th>

                            </tr>
                            <tr zippy="customerlist">
                                <td><input class="seldel" zippy="seldel"  type="checkbox"></td>

                                <td   ><a zippy="customername"></a></td>
                                <td zippy="customerphone" class="text-nowrap"></td>
                                <td zippy="customeremail" class="text-nowrap"></td>
                                <td zippy="customeredrpou" class="text-nowrap"></td>
                                {{^leadmode}}    <td class="text-right" > <span zippy="docs" class="badge badge-secondary badge-pill"></span> </td>  {{/leadmode}}
                                {{#leadmode}}  
                                <td zippy="leadstatus">  </td>  
                                {{/leadmode}}    
                                {{#leadmode}}  
                                <td zippy="createddate">  </td>  
                                {{/leadmode}}    
                                <td   ><i    zippy="hasaction" class="fa fa-gift"></i></td>

                                                     
                                <td><i zippy="customercomment" class="far fa-sticky-note" data-toggle="tooltip" data-placement="left"></i></td>

                                <td><i zippy="hasmsg" class="fa fa-comments" title="Коментарии"></i></td>
                                <td><i zippy="hasfiles" class="fa fa-paperclip" title="Прикрепленные  файлы  "></i></td>
                                <td><i zippy="isplanned" class="fa fa-calendar-alt" title="Запланированные события"></i></td>

                                <td style="white-space:  nowrap"> &nbsp;&nbsp;
                                    <a zippy="edit" title="Редактировать"><i class="fa fa-edit"></i></a>
                                    &nbsp;&nbsp;&nbsp;<a zippy="contentlist" title="Дополнительные данные"><i
                                            class="fa fa-eye"></i></a>

                                </td>

                            </tr>
                            <tr><td><a class="text-danger" zippy="deleteall" title="Удалить (леактивировать)"><i class="fa fa-trash"></i></a></td><td colspan="9"></td></tr>

                        </table>
                        <div style="width:50%" zippy="pag"></div>
                    </form>
                </div>


            </div>
        </div>


        <form class="row" zippy="customerdetail" method="post">
            <h4>&nbsp; Редактировать  </h4>
            <div class="w-100"></div>
            <div class="col-12 col-md-4 ">

                <div class="form-group">
                    <label for="editcustomername">Название</label>
                    <input autofocus="on"    required="on"  class="form-control" zippy="editcustomername"/>
                    {{#leadmode}}  
                    <small>Можно использовать контакт как  временное  имя</small>
                    {{/leadmode}}  
                </div>

                <div class="form-group">
                    <label for="editemail">E-Mail</label>
                    <input class="form-control" zippy="editemail"/>
                </div>
                <div class="form-group">
                    <label for="editphone">Телефон</label>
                    <input pattern="[0-9()\+\s]+" class="form-control" zippy="editphone"/>
                </div>
                <div class="form-group">
                    <label for="editviber">Viber</label>
                    <input class="form-control" zippy="editviber"/>
                </div>
                <div class="form-group">
                    <label for="edittelega">Телеграм</label>
                    <input class="form-control" zippy="edittelega"/>
                </div>



                {{#leadmode}} 
                <div class="form-group">
                    <label for="editleadsource">Источник  лида</label>
                    <select class="form-control" zippy="editleadsource">
                        <option value="0">Не указано</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editleadstatus">Состояние лида</label>
                    <select class="form-control" zippy="editleadstatus">
                        <option value="0">Не указано</option>
                    </select>
                </div>
                {{/leadmode}} 

                {{^leadmode}} 
                <div class="form-group">
                    <label for="edittype">Тип</label>
                    <select zippy="edittype" class="form-control">
                        <option value="0">Не указано</option>
                    </select>
                </div>
                <div class="form-check">
                    <input zippy="editisholding" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editisholding">Холдинг</label>
                    <br><small>Компания (или  просто условное имя), что обединяет контрагентов для  консолидированной отчетности  </small>
                </div>
                <div class="form-group">
                    <label for="editholding">Дочерняя для холдинга</label>
                    <select zippy="editholding" class="form-control">
                        <option value="0">Не выбрано</option>
                    </select>
                </div>
            
                <div class="form-check">
                    <input zippy="editnosubs" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editnosubs">Не учитывать в  подписках</label>
                </div>
                <div class="form-check">
                    <input zippy="editdisabled" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editdisabled">Больше не  используется</label>
                </div>        
                {{/leadmode}} 
       
            </div>

            <div class="col-12 col-md-4 ">
                {{^leadmode}}  
                {{#hideblock}}
                <div class="form-group">
                    <label for="editcity">Страница</label>
                    <input class="form-control" zippy="editcity"/>
                </div>
                  {{/hideblock}}
                <div class="form-group">
                    <label for="editcountry">Город</label>
                    <input class="form-control" zippy="editcountry"/>
                </div>
                <div class="form-group">
                    <label for="editaddress">Полный адрес</label>
                    <input class="form-control" zippy="editaddress"/>
                    <small>Для накладных  и счетов-фактур</small>
                </div>
                <div class="form-group">
                    <label for="editaddressdel">Адрес доставки</label>
                    <input class="form-control" zippy="editaddressdel"/>
                </div>

                <div class="form-group">
                    <label for="editedrpou">ОКПО</label>
                    <input value="0" class="form-control"   zippy="editedrpou">
                </div>

                <div class="form-check">
                    <input zippy="editjurid" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editjurid">Юр. лицо</label>
                </div>
                
           <div class="form-group  ">
                        <label for="editpricetype">Тип цени</label>
                        <select class="form-control" zippy="editpricetype">
                         <option value="none">Не выбрано</option>                         </select>
                         <small>Для подстановки в накладных<small>
                    </div>         
                
                {{/leadmode}} 
                
               {{#shop}}        
                <div class="form-group">
                    <label for="editpassword">Пароль логина для онлайн-каталогу</label>
                    <input class="form-control" zippy="editpassword"  type="password"/>
                    <small>Оставте пустым  если пароль не  меняется</small>
                </div>
                 <div class="form-group">
                    <label for="editconfirm">Подтвердить пароль</label>
                    <input class="form-control" zippy="editconfirm" type="password"/>
                </div>
           
               <div class="form-check">
                    <input zippy="editallowedshop" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editallowedshop"   data-label="editallowedshop">Разрешение на просмотр онлайн каталога</label>
                </div>        
                {{/shop}}                 
                <div class="form-group">
                    <label for="editcomment">Примечание</label>
                    <textarea style="height:100px" class="form-control" zippy="editcomment"></textarea>
                </div>
        <div class="form-group">
                   <label for="edittags">Тэги</label>
                   <div zippy="edittags"> </div>
                   <small>Вводятся по  Enter</small>
              </div>                 
            </div>    

            <div class="w-100"></div>
            <div class="col-12 col-md-4 ">
                <div class="form-group">
                    <button zippy="cancel" type="button" class="btn btn-outline-secondary mr-2">Отменить</button>
                    <button zippy="save" type="submit" class="btn btn-primary ">Сохранить</button> 
                    

                </div>
            </div>
        </form>


        <a name="contentviewlink"></a>
        <div class="row mt-2" zippy="contentview">
            <div class="col-12 pb-4">
                <a zippy="back"><i class="fa fa-arrow-circle-left"></i> К списку</a>
                <h4 zippy="concname"></h4>

                <table>
                    <tr><td colspan="2">
                            <span  zippy="concreated"></span>
                        </td></tr>
                    <tr><td colspan="2">
                            <span  zippy="conlastdoc"></span> 
                        </td></tr>
                    <tr><td ><span data-label="conphone">Телефон</span></td><td><span zippy="conphone"></span></td></tr>
                    <tr><td ><span data-label="conemail">E-Mail</span></td><td><span zippy="conemail"></span></td></tr>
                </table>
         
                {{#leadmode}} 

                <form zippy="conlstform" class="form-inline ">
                    <label for="conleadstatus"> Состояние</label> 
                    <select zippy="conleadstatus" class="form-control mr-4"></select>
                    &nbsp;&nbsp; <a zippy="convert"> <i class="fa fa-gavel"></i> Конвертировать в контрагента </a>
                </form>




                {{/leadmode}} 

            </div>
            <div class="col-6  col-md-4 col-xl-3 card">
                
                     

                        <h5> Расписание событий </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_eventlist">
                                <td><span zippy="eventdate"></span><br>
                                    <b zippy="eventtitle"></b>
                                    <p zippy="eventdesc">
                                    </p>
                                </td>

                                <td valign="top" style="width: 30px;"><a zippy="delevent"><i class="fa fa-trash"></i></a></td>
                            </tr>
                        </table>
                        <div zippy="eventpag"></div>
                        <hr>

                        <form zippy="addeventform">
                            <div class="form-group row">
                                <label class="col-12 col-form-label" for="addeventdate">Дата, время</label>

                                <div class="col-6">
                                    <input   class="form-control"   zippy="addeventdate" >
                                </div>
                                <div class="col-4"> 
                                    <input   class="form-control"   zippy="addeventtime" >
                                </div>                                

                            </div>
                            <div class="form-group">
                                <label for="addeventtitle">Заголовок, тип события</label>
                                <input  required="on"  class="form-control" zippy="addeventtitle">
                            </div>
                            <div class="form-group">
                                <label for="addeventdesc">Коментарий</label>
                                <textarea class="form-control" zippy="addeventdesc" style=" height:120px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="addeventnotify">Напомнить уведомлением за</label>
                                <select class="form-control" zippy="addeventnotify">
                                    <option value="0">Не напоминать</option>
                                    <option value="1">1 час</option>
                                    <option value="2">2 часа</option>
                                    <option value="4">4 часа</option>
                                    <option value="8">8 часов</option>
                                    <option value="16">16 часов</option>
                                    <option value="24">24 часов</option>
                             </select>
                            </div>
                            <input class="btn btn-outline-success  " type="submit" value="Добавить">
                        </form>
                
               
            </div>
            <div class="col-6  col-md-4 col-xl-3 card">
                   <h5> Коментарі </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_msglist">
                                <td>
                                    <span><b zippy="msguser"></b> <span zippy="msgdate" class="text-muted float-right"></span></span>

                                    <p zippy="msgdata"></p>
                                </td>
                                <td valign="top" style="width: 30px;"><a zippy="delmsg"><i class="fa fa-trash"></i></a></td>
                            </tr>
                        </table>
                        <hr>
                        <form zippy="addmsgform">
                            <div class="form-group">
                                <label for="addmsg">Коментарий</label>
                                <textarea  required="on"  class="form-control" zippy="addmsg"
                                          style=" height:120px;"></textarea>
                            </div>
                            <input class="btn btn-outline-success  " type="submit" value="Добавить">
                        </form>
            </div>
            <div class="col-6 col-md-4 col-xl-3 card">
                        <h5> Прикрепленные файлы </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_files">
                                <td><a zippy="filename" target="_blank"></a></td>
                                <td style="width: 30px;"><a zippy="delfile"><i class="fa fa-trash"></i></a></td>
                            </tr>
                        </table>
                        <hr>
                        <form zippy="addfileform" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="addfile">Выбрать файл</label>
                                <input type="file" class="form-control"  required="on"  zippy="addfile">

                            </div>

                            <div class="form-group">
                                <label for="adddescfile">Описание </label>
                                <input class="form-control" zippy="adddescfile">
                            </div>


                            <input class="btn btn-outline-success  " type="submit" value="Добавить">

                        </form>
            </div>
              {{^leadmode}}


            {{#iscontract}}

            <div class="col-6 col-md-4 col-xl-3 ">
                <div class="card">

                        <h5> Договора </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_contr">
                                <td><a title="Перейти" zippy="contract"></a></td>
                                <td><span zippy="contract_desc"></span></td>

                            </tr>
                        </table>


                </div>
            </div>
             {{/iscontract}}
            
            
            <div class="col-6 col-md-4 col-xl-3 ">
                <div class="card">

                        <h5> последние документы </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_doc">
                                <td><a title="Перейти" zippy="doc"></a></td>
                                <td class="text-right"><span zippy="doc_amount"></span></td>
                                <td><span zippy="doc_state"></span></td>

                            </tr>
                        </table>


                </div>
            </div>

            {{/leadmode}}             
        </div>


        <form zippy="leadsourcesform">
            <div class="row">
                <div class="col-12  col-md-6 col-xl-4">
                    <h5>Редактирование  источников лидов</h5>
                    <small>Исчтоники лидов, например, 'инстаграм', 'звонок'...</small>  <br>
                    <a  zippy="addnewsource">Добавить</a>

                    <table class="table table-sm">
                        <tr zippy="leadsourceslist">
                            <td><input class="form-control" style="width:250px;" zippy="leadsourcename"  ></td>
                            <td><a zippy="delsource"> <i class="fa fa-trash"></i></a></td>
                         </tr>   
                    </table>
                    <a  zippy="leadsourcecancel" class="btn btn-outline-primary mr-2">Отменить</a>
                    <input zippy="leadsourcesave"  type="submit"  value="Сохранить" class="btn  btn-info">
                    
                </div>
            </div>
        </form>

        <form zippy="leadstatusesform">
            <div class="row">
                <div class="col-12  col-md-6 col-xl-4">
                    <h5>Редактирование состояния лидов</h5>
                    <small>Состояние дида например, 'ожидает', 'переговоры'...</small>  <br>
                    <a  zippy="addnewstatus">Добавить</a>

                    <table class="table table-sm">
                        <tr zippy="leadstatuseslist">
                            <td><input class="form-control" style="width:250px;" zippy="leadstatusname"  ></td>
                            <td><a zippy="delstatus"> <i class="fa fa-trash"></i></a></td>
                              </tr> 
                    </table>
                    <a  zippy="leadstatuscancel" class="btn btn-outline-primary  mr-2">Отменить</a>
                    <input zippy="leadstatussave"  type="submit"  value="Сохранить" class="btn  btn-info">
                    
                </div>
            </div>
        </form>
        {{#leadmode}}  


        <div    zippy="statpan">

            &nbsp;      <a zippy="closestat"><i class="fa fa-arrow-alt-circle-left"></i> Назад</a>
            <div class="row"   >
                <div   class="col-12  col-md-6  col-xl-4  ">
                    <div class="card">
                        

                            <div style="width:100%" id="statusesg"></div>

                       
                    </div>
                </div>
                <div   class="col-12  col-md-6  col-xl-4  ">
                    <div class="card">
                        

                            <div style="width:100%" id="sourcesg"></div>
                      
                    </div>
                </div>
                <div   class="col-12  col-md-6  col-xl-4  ">
                    <div class="card">
                       

                            <div style="width:100%" id="sourcescustg"></div>
                       
                    </div>
                </div>

            </div>  

        </div>  








     <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart'], 'language': 'uk'});
      google.charts.setOnLoadCallback(drawChart);

      
    var fontcolor='#000' ;
    var bgcolor='#fff' ;
        {{#darkmode}}
            fontcolor='#fff' ;
            bgcolor='#333' ;
        {{/darkmode}}             
        
 
 
      function drawChart() {
 
             
        var rg1data = google.visualization.arrayToDataTable( 
        
          {{{gr1}}}
        
        );

        
        var rg1options = {
          title: 'Стан лідів' ,
          sliceVisibilityThreshold: 0.01,         
          backgroundColor: {
            "fill":bgcolor 
          } , 
          titleTextStyle:{
             "color":fontcolor ,"bold":true
          } ,
                   
          chartArea:{
             "top":25,"bottom":5,"left":10 , "right":60
          } ,
                  
          legendTextStyle:{
             "color":fontcolor 
          } ,
                  
        };

  
       //старвнение
        var rg1chart = new google.visualization.PieChart(document.getElementById('statusesg'));

        rg1chart.draw(rg1data, rg1options);
        
       
        var rg2data = google.visualization.arrayToDataTable( 
        
          {{{gr2}}}
        
        );

        
        var rg2options = {
          title: 'Джерела лідів' ,
          sliceVisibilityThreshold: 0.01,         
          backgroundColor: {
            "fill":bgcolor 
          } , 
          titleTextStyle:{
             "color":fontcolor ,"bold":true
          } ,
                   
          chartArea:{
             "top":25,"bottom":5,"left":10 , "right":60
          } ,
                  
          legendTextStyle:{
             "color":fontcolor 
          } ,
                  
        };

  
       //старвнение
        var rg2chart = new google.visualization.PieChart(document.getElementById('sourcesg'));

        rg2chart.draw(rg2data, rg2options);
        
  
        var rg3data = google.visualization.arrayToDataTable( 
        
          {{{gr3}}}
        
        );

        
        var rg3options = {
          title: 'Джерела  конвертованих лідів' ,
          sliceVisibilityThreshold: 0.01,         
          backgroundColor: {
            "fill":bgcolor 
          } , 
          titleTextStyle:{
             "color":fontcolor ,"bold":true
          } ,
                   
          chartArea:{
             "top":25,"bottom":5,"left":10 , "right":60
          } ,
                  
          legendTextStyle:{
             "color":fontcolor 
          } ,
                  
        };

  
       //старвнение
        var rg3chart = new google.visualization.PieChart(document.getElementById('sourcescustg'));

        rg3chart.draw(rg3data, rg3options);
        
        
        
        
        
        
        
        
        
        
        
      }                  
        </script> 

        {{/leadmode}}  

        <script>
            function check_deleteall() {

            return confirm("Удалить?")

            }


        </script>


    </body>
</html>





 
 
