<html>
    <head>
        <link rel="stylesheet" href="/assets/css/chart.css">

             <title> Справочник контрагентов</title>
 
    </head>

    <body>
        <div class="row">
            <div class="col-12   col-xl-10  ">
                <div zippy="customertable">
                    <h2>Справочник контрагентов </h2>
                    <div class="navbar nav  ">
                        <form zippy="leadf" class="form-inline ">
                            <input   zippy="chleads" type="checkbox"> <b>Режим работы с лидами </b>
                        </form>
                    </div>
                    <div class="navbar nav  ">
                        <form zippy="filter" class="form-inline ">

                            <label for="searchkey">Поиск</label>
                            <input class="form-control mr-sm-2" type="text" zippy="searchkey">
                            {{^leadmode}}
                            <label for="searchtype">Тип</label>
                            <select zippy="searchtype" class="form-control mr-sm-2">
                                <option value="0">Все активные</option>
                                <option value="1">Покупатели</option>
                                <option value="2">Поставщики</option>
                                <option value="5">Холдинги</option>
                                <option value="10">Деактивированные</option>
                            </select>

                            <label for="searchholding">дочерний для</label>
                            <select zippy="searchholding" class="form-control mr-sm-2">
                                <option value="0">Не указано</option>
                            </select>
                            {{/leadmode}}
                            {{#leadmode}} 
                            <label for="searchleadsource">источник</label>
                            <select zippy="searchleadsource" class="form-control mr-2">
                                <option value="0">Не указано</option>
                            </select>    
                            <label for="searchleadstatus">состояние</label>
                            <select zippy="searchleadstatus" class="form-control mr-2">
                                <option value="0">Не указано</option>
                            </select>    
                            {{/leadmode}} 
                            <input class="btn btn-outline-success   " type="submit" value="ОК"  >

                        </form>
                        {{#leadmode}}  

                        <a class="btn btn-outline-success"   zippy="leadsourcesedit"  ><i class="fa fa-cog"> Источник лидов</i> </a>
                        &nbsp; <a class="btn btn-outline-success    " zippy="leadstatusesedit"  ><i class="fa fa-cog"> Состояние лидов</i> </a>
                        {{/leadmode}}            
                    </div>
                    {{#leadmode}}  
                    <div class="mb-4 ml-2">



                        <a zippy="showstat"><i class="fa fa-chart-area"></i> Статистика</a>




                    </div>
                    {{/leadmode}}  
                    <a zippy="addnew" class="btn btn-primary">Добавить новый</a>

                    <form zippy="listform">
                        <table class="table table-hover   table-sm mt-2">
                            <tr>
                                <th onclick=" $('.seldel').prop('checked', $('.seldel').prop('checked') == false);"
                                    style="width:30px;cursor:pointer" title="Снять/выставить флажки"><i
                                        class="fa fa-check-double"></i></th>

                                <th ><a zippy="sortname">Имя</a> </th>
                                <th >Тел.</th>
                                <th >E-Mail</th>
                                {{^leadmode}}        <th  ><a zippy="sortdoc">Док.</a> </th>    {{/leadmode}}
                                {{#leadmode}}     <th><a zippy="sortleadstatus">Сост. лида</a> </th>     {{/leadmode}} 
                                <th> </th>
                                <th> </th>
                                <th> </th>


                                <th> </th>
                                <th> </th>
                                <th> </th>

                            </tr>
                            <tr zippy="customerlist">
                                <td><input class="seldel" zippy="seldel"  type="checkbox"></td>

                                <td zippy="customername" class="text-nowrap"></td>
                                <td zippy="customerphone" class="text-nowrap"></td>
                                <td zippy="customeremail" class="text-nowrap"></td>
                                {{^leadmode}}    <td class="text-right" > <span zippy="docs" class="badge badge-secondary badge-pill"></span> </td>  {{/leadmode}}
                                {{#leadmode}}  
                                <td zippy="leadstatus">  </td>  
                                {{/leadmode}}    
                                <td   ><i    zippy="hasaction" class="fa fa-gift"/></td>

                                                     
                                <td><i zippy="customercomment" class="far fa-sticky-note" data-toggle="tooltip" data-placement="left"></i></td>

                                <td><i zippy="hasmsg" class="fa fa-comments" title="Комментарии"></i></td>
                                <td><i zippy="hasfiles" class="fa fa-paperclip" title="Прикрепленные файлы  "></i></td>
                                <td><i zippy="isplanned" class="fa fa-calendar-alt" title="Запланированные события"></i></td>

                                <td style="white-space:  nowrap"> &nbsp;&nbsp;
                                    <a zippy="edit" title="Редактировать"><i class="fa fa-edit"></i></a>
                                    &nbsp;&nbsp;&nbsp;<a zippy="contentlist" title="Редактировать дополнительные данные"><i
                                            class="fa fa-eye"></i></a>

                                </td>

                            </tr>
                            <tr><td><a class="text-danger" zippy="deleteall" title="Удалить (деактивировать)"><i class="fa fa-trash"></i></a></td><td colspan="9"></td></tr>

                        </table>
                        <div zippy="pag"></div>
                    </form>
                </div>


            </div>
        </div>


        <form class="row" zippy="customerdetail" method="post">
            <h4>&nbsp; Редактировать  </h4>
            <div class="w-100"></div>
            <div class="col-12 col-md-4 ">

                <div class="form-group">
                    <label for="editcustomername">Название</label>
                    <input required="required" class="form-control" zippy="editcustomername"/>
                    {{#leadmode}}  
                    <small>Можно использовать контакт как временное имя</small>
                    {{/leadmode}}  
                </div>

                <div class="form-group">
                    <label for="editemail">E-Mail</label>
                    <input class="form-control" zippy="editemail"/>
                </div>
                <div class="form-group">
                    <label for="editphone">Телефон</label>
                    <input pattern="[0-9()\+\s]+" class="form-control" zippy="editphone"/>
                </div>
                <div class="form-group">
                    <label for="editviber">Viber</label>
                    <input class="form-control" zippy="editviber"/>
                </div>



                {{#leadmode}} 
                <div class="form-group">
                    <label for="editleadsource">Источник лида</label>
                    <select class="form-control" zippy="editleadsource">
                        <option value="0">Не указано</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editleadstatus">Состояние лида</label>
                    <select class="form-control" zippy="editleadstatus">
                        <option value="0">Не указано</option>
                    </select>
                </div>
                {{/leadmode}} 

                {{^leadmode}} 
                <div class="form-group">
                    <label for="edittype">Тип</label>
                    <select zippy="edittype" class="form-control">
                        <option value="0">Не указано</option>
                    </select>
                </div>
                <div class="form-check">
                    <input zippy="editisholding" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editisholding">Холдинг</label>
                    <small>Компания, что объединяет дочерние компании. Используется для консолидированных отчетов</small>
                </div>
                <div class="form-group">
                    <label for="editholding">Дочерняя для холдинга</label>
                    <select zippy="editholding" class="form-control">
                        <option value="0">Не выбрано</option>
                    </select>
                </div>
                {{#shop}}        
                <div class="form-group">
                    <label for="editpassword">Пароль логина для каталога</label>
                    <input class="form-control" zippy="editpassword"  type="password"/>
                    <small>Оставьте пустым, если пароль не меняется</small>
                </div>
                 <div class="form-group">
                    <label for="editconfirm">Подтвердить пароль</label>
                    <input class="form-control" zippy="editconfirm" type="password"/>
                </div>
           
               <div class="form-check">
                    <input zippy="editallowedshop" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editallowedshop" for="editallowedshop" data-label="editallowedshop">Разрешение на просмотр онлайн-каталога</label>
                </div>        
                {{/shop}}        
                <div class="form-check">
                    <input zippy="editnosubs" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editnosubs">Не учитывать в подписках</label>
                </div>
                <div class="form-check">
                    <input zippy="editdisabled" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editdisabled">Больше не используется</label>
                </div>        
                {{/leadmode}} 

            </div>

            <div class="col-12 col-md-4 ">
                {{^leadmode}}  
                <div class="form-group">
                    <label for="editcity">Страна</label>
                    <input class="form-control" zippy="editcity"/>
                </div>
                <div class="form-group">
                    <label for="editcountry">Город</label>
                    <input class="form-control" zippy="editcountry"/>
                </div>
                <div class="form-group">
                    <label for="editaddress">Полный адрес</label>
                    <input class="form-control" zippy="editaddress"/>
                </div>

                <div class="form-group">
                    <label for="editedrpou">ОКПО</label>
                    <input value="0" class="form-control"   zippy="editedrpou">
                </div>

                <div class="form-check">
                    <input zippy="editjurid" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="editjurid">Юр. особа</label>
                </div>
                
           <div class="form-group  ">
                        <label for="editpricetype">Тип цены</label>
                        <select class="form-control" zippy="editpricetype">
                         <option value="none">Не выбрано</option>
                        </select>
                    </div>         
                
                {{/leadmode}} 
                <div class="form-group">
                    <label for="editcomment">Примечание</label>
                    <textarea style="height:100px" class="form-control" zippy="editcomment"></textarea>
                </div>
            </div>    

            <div class="w-100"></div>
            <div class="col-12 col-md-4 ">
                <div class="form-group">
                    <button zippy="save" type="submit" class="btn btn-primary ">Сохранить</button> &nbsp;&nbsp;
                    <button zippy="cancel" type="button" class="btn btn-outline-secondary">Отменить</button>

                </div>
            </div>
        </form>


        <a name="contentviewlink"></a>
        <div class="row mt-2" zippy="contentview">
            <div class="col-12 pb-4">
                <a zippy="back"><i class="fa fa-arrow-circle-left"></i> К списку</a>
                <h4 zippy=concname></h4>

                <table>
                    <tr><td colspan="2">
                            <span  zippy="concreated"></span>
                        </td></tr>
                    <tr><td colspan="2">
                            <span  zippy="conlastdoc"></span> 
                        </td></tr>
                    <tr><td ><span data-label="conphone">Phone</span></td><td><span zippy="conphone"></span></td></tr>
                    <tr><td ><span data-label="conemail">E-Mail</span></td><td><span zippy="conemail"></span></td></tr>
                </table>

                {{#leadmode}} 

                <form zippy="conlstform" class="form-inline ">
                    <label for="conleadstatus"> Состояние</label> 
                    <select zippy="conleadstatus" class="form-control mr-4"></select>
                    &nbsp;&nbsp; <a zippy="convert"> <i class="fa fa-gavel"></i> Конвертировать в контрагента </a>
                </form>




                {{/leadmode}} 

            </div>
            <div class="col-4 col-xl-3 ">
                <div class="card">
                    <div class="card-body">

                        <h5> Расписание событий </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_eventlist">
                                <td><span zippy="eventdate"></span><br>
                                    <b zippy="eventtitle"></b>
                                    <p zippy="eventdesc">
                                    </p>
                                </td>

                                <td valign="top" style="width: 30px;"><a zippy="delevent"><i class="fa fa-trash"></i></a></td>
                            </tr>
                        </table>
                        <div zippy="eventpag"></div>
                        <hr>

                        <form zippy="addeventform">
                            <div class="form-group">
                                <label for="addeventdate">Дата, время</label>

                                <div class="input-group">
                                    <input   class="form-control"   zippy="addeventdate" >
                                    <span class="input-group-text">:</span>
                                    <input   class="form-control"   zippy="addeventtime" >
                                </div>                                

                            </div>
                            <div class="form-group">
                                <label for="addeventtitle">Заголовок, тип события</label>
                                <input required="required" class="form-control" zippy="addeventtitle">
                            </div>
                            <div class="form-group">
                                <label for="addeventdesc">Комментарий</label>
                                <textarea class="form-control" zippy="addeventdesc" style=" height:120px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="addeventnotify">Напомнить сообщением за</label>
                                <select class="form-control" zippy="addeventnotify">
                                    <option value="0">Не напоминать</option>
                                    <option value="1">1 час</option>
                                    <option value="2">2 часа</option>
                                    <option value="4">4 часа</option>
                                    <option value="8">8 часов</option>
                                    <option value="16">16 часов</option>
                                    <option value="24">24 часа</option>
                             </select>
                            </div>
                            <input class="btn btn-outline-success  " type="submit" value="Добавить">
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-4 col-xl-3 ">
                <div class="card">
                    <div class="card-body">
                        <h5> Коментар </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_msglist">
                                <td>
                                    <span><b zippy="msguser"></b> <span zippy="msgdate" class="text-muted float-right"></span></span>

                                    <p zippy="msgdata"></p>
                                </td>
                                <td valign="top" style="width: 30px;"><a zippy="delmsg"><i class="fa fa-trash"></i></a></td>
                            </tr>
                        </table>
                        <hr>
                        <form zippy="addmsgform">
                            <div class="form-group">
                                <label for="addmsg">Комментарий</label>
                                <textarea required="required" class="form-control" zippy="addmsg"
                                          style=" height:120px;"></textarea>
                            </div>
                            <input class="btn btn-outline-success  " type="submit" value="Добавить">
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-4 col-xl-3 ">
                <div class="card">
                    <div class="card-body">
                        <h5> Прикрепленные файлы </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_files">
                                <td><a zippy="filename" target="_blank"></a></td>
                                <td style="width: 30px;"><a zippy="delfile"><i class="fa fa-trash"></i></a></td>
                            </tr>
                        </table>
                        <hr>
                        <form zippy="addfileform" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="addfile">Выбрать файл</label>
                                <input type="file" class="form-control" required="required" zippy="addfile">

                            </div>

                            <div class="form-group">
                                <label for="adddescfile">Описание </label>
                                <input class="form-control" zippy="adddescfile">
                            </div>


                            <input class="btn btn-outline-success  " type="submit" value="Добавить">

                        </form>
                    </div>
                </div>
            </div>
            <div class="col-4 col-xl-3 ">
                <div class="card">
                    <div class="card-body">
                        <h5> Договора </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_contr">
                                <td><a title="Перейти" zippy="contract"></a></td>
                                <td><span zippy="contract_desc"></span></td>

                            </tr>
                        </table>

                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5> Бонусы </h5>
                        <table class="table table-sm">
                            <tr zippy="dw_bonus">
                                <td zippy="b_date"></td>
                                <td zippy="b_doc"></td>
                                <td zippy="b_bonus" class="text-right"></td>

                            </tr>
                            <tr><td></td> <td class="text-right"><b>Всего:</b></td> <td class="text-right"><b zippy="b_total"></b></td>  </tr>
                        </table>

                    </div>
                </div>
            </div>
        </div>


        <form zippy="leadsourcesform">
            <div class="row">
                <div class="col-12  col-md-6 col-xl-4">
                    <h5>Редактирование источников лидов</h5>
                    <small>Источники лидов, например, 'инстаграм', 'звонок'...</small>  <br>
                    <a  zippy="addnewsource">Добавить</a>

                    <table class="table table-sm">
                        <tr zippy="leadsourceslist">
                            <td><input style="width:250px;" zippy="leadsourcename"  ></td>
                            <td><a zippy="delsource"> <i class="fa fa-trash"></i></a></td>
                    </table>
                    <input zippy="leadsourcesave"  type="submit"  value="Сохранить" class="btn  btn-info">
                    <a  zippy="leadsourcecancel" class="btn btn-outline-primary ">Отменить</a>
                </div>
            </div>
        </form>

        <form zippy="leadstatusesform">
            <div class="row">
                <div class="col-12  col-md-6 col-xl-4">
                    <h5>Редактирование состояний лидов</h5>
                    <small>Состояние лида, например, 'ожидает', 'переговоры'...</small>  <br>
                    <a  zippy="addnewstatus">Добавить</a>

                    <table class="table table-sm">
                        <tr zippy="leadstatuseslist">
                            <td><input style="width:250px;" zippy="leadstatusname"  ></td>
                            <td><a zippy="delstatus"> <i class="fa fa-trash"></i></a></td>
                    </table>
                    <input zippy="leadstatussave"  type="submit"  value="Сохранить" class="btn  btn-info">
                    <a  zippy="leadstatuscancel" class="btn btn-outline-primary ">Отменить</a>
                </div>
            </div>
        </form>
        {{#leadmode}}  


        <div    zippy="statpan">

            &nbsp;      <a zippy="closestat"><i class="fa fa-arrow-alt-circle-left"></i> Назад</a>
            <div class="row"   >
                <div   class="col-12  col-md-6  col-xl-4  ">
                    <div class="card">
                        <div class="card-body">


                            <canvas style="width:100%" id="statusesg"></canvas>

                        </div>
                    </div>
                </div>
                <div   class="col-12  col-md-6  col-xl-4  ">
                    <div class="card">
                        <div class="card-body">


                            <canvas style="width:100%" id="sourcesg"></canvas>

                        </div>
                    </div>
                </div>
                <div   class="col-12  col-md-6  col-xl-4  ">
                    <div class="card">
                        <div class="card-body">


                            <canvas style="width:100%" id="sourcescustg"></canvas>

                        </div>
                    </div>
                </div>

            </div>  

        </div>  








        <script language="javascript" src="/assets/js/chart.js"></script>

        <script>
        
        var fontcolor='#000' ;
        {{#darkmode}}
            fontcolor='#fff' ;
        {{/darkmode}}        
        
//состояние лидов
                                    var pieData1 = {
                                    labels: {{{gr1title}}},
                                            datasets: [
                                            {
                                            data: {{{gr1data}}},
                                                    backgroundColor : {{{gr1color}}},
                                            }
                                            ]
                                    }


                                    var pieOptions1 = {
                                    maintainAspectRatio : false,
                                            responsive : true,
                                            title: {
                                            display: true,   fontColor: fontcolor,
                                                    text: 'Состояния лидов',
                                                    position: 'top'

                                            },
                                            legend: {
                                            display: true,
                                                    position: 'right',
                                                    labels: {
                                                    boxWidth: 10,
                                                            fontColor: fontcolor,
                                                            padding:  2
                                                    }
                                            },
                                            tooltips: {
                                            enabled: true
                                            },
                                    }

                                    var pieData2 = {
                                    labels: {{{gr2title}}},
                                            datasets: [
                                            {
                                            data: {{{gr2data}}},
                                                    backgroundColor : {{{gr2color}}},
                                            }
                                            ]
                                    }


                                    var pieOptions2 = {
                                    maintainAspectRatio : false,
                                            responsive : true,
                                            title: {
                                            display: true,    fontColor: fontcolor,
                                                    text: 'Источники лидов',
                                                    position: 'top'

                                            },
                                            legend: {
                                            display: true,
                                                    position: 'right',
                                                    labels: {
                                                    boxWidth: 10,
                                                            fontColor: fontcolor,
                                                            padding:  2
                                                    }
                                            },
                                            tooltips: {
                                            enabled: true
                                            },
                                    }

                                    var pieData3 = {
                                    labels: {{{gr3title}}},
                                            datasets: [
                                            {
                                            data: {{{gr3data}}},
                                                    backgroundColor : {{{gr3color}}},
                                            }
                                            ]
                                    }


                                    var pieOptions3 = {
                                    maintainAspectRatio : false,
                                            responsive : true,
                                            title: {
                                            display: true,    fontColor: fontcolor,
                                                    text: 'Источники конвертированных лидов',
                                                    position: 'top'

                                            },
                                            legend: {
                                            display: true,
                                                    position: 'right',
                                                    labels: {
                                                    boxWidth: 10,
                                                            fontColor: fontcolor,
                                                            padding:  2
                                                    }
                                            },
                                            tooltips: {
                                            enabled: true
                                            },
                                    }


                                    window.onload = function() {


                                    new Chart(document.querySelector('#statusesg'), {
                                    type: 'pie',
                                            data: pieData1,
                                            options: pieOptions1
                                    })




                                            new Chart(document.querySelector('#sourcesg'), {
                                            type: 'pie',
                                                    data: pieData2,
                                                    options: pieOptions2
                                            })



                                            new Chart(document.querySelector('#sourcescustg'), {
                                            type: 'pie',
                                                    data: pieData3,
                                                    options: pieOptions3
                                            })



                                    };
        </script> 

        {{/leadmode}}  

        <script>
            function check_deleteall() {

            return confirm("Удалить?")

            }
        </script>


    </body>
</html>
